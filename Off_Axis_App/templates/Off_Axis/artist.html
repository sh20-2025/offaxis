{% extends "Off_Axis/base.html" %}
{% load static %}


{% block title_block %}
    Artist profile
{% endblock %}

{% block import_block %}
    <link rel = "stylesheet" href="{% static "styles/profile.css" %}">
    <link rel="stylesheet" href="{% static "styles/gigs_section.css" %}">
    <script src="{% static "scripts/profile_upload_image.js" %}" type="module" defer></script>
    <script src="{% static "scripts/profile_edit_info.js" %}" type="module" defer></script>
    <script src="{% static "scripts/profile_add_genres.js" %}" type="module" defer></script>
    <script src="{% static "scripts/profile_add_social_links.js" %}" type="module" defer></script>
    <script src="{% static 'scripts/delete_social_link.js' %}" type="module" defer></script>
    <script src="{% static 'scripts/profile-gig-form.js' %}" type="module" defer></script>

{% endblock %}

{% block body_block %}

{% if user == artist.user or user.is_staff%}
    <section id="approval-section">
        <h2 >Approval Status</h2>
        <p>{{ artist.user.username }}'s Approval Status: {{ artist.is_approved }}</p>
        {% if user.is_staff %}
            <form method="post" action="{% url 'approve_artist' artist.slug %}">
                {% csrf_token %}
                <label for="approve">Approve Artist:</label>
                <input type="checkbox" id="approve" name="approve" {% if artist.is_approved %}checked{% endif %}>
                {% include "components/button.html" with id="button3" type="submit" variant="secondary" text="Save" size="sm" %}
            </form>
        {% endif %}
    </section>

    {% endif %}


    {% if artist.is_approved or user.is_staff or user == artist.user %}
    <section class="profile">
    <section class="profile-picture">
        {% if artist.profile_picture %}
          <img src="{{ artist.profile_picture.url}}" alt="profile picture" id="profile-picture"/>
        {% else %}
          <img src="{% static "icons/image.svg" %}" alt="profile picture" id="profile-picture"/>
          <p>No Profile Picture Given.</p>
        {% endif %}
          {% if user == artist.user or user.is_staff%}
          <h5> Upload image? </h5>
          <div class="upload-container">
             {% csrf_token %}
             <input type="file" id="upload-picture"
                    name="profile_picture"
                    accept="image/*"
                    data-artist-slug="{{ artist.slug }}">
                 {% include "components/button.html" with id="custom-upload-button" type="button" variant="primary" text="Upload Image" size="sm" %}
          </div>
          {% endif %}

    </section>


    <section class="profile-header">
        <h1>{{ artist.user.username }}</h1>

        <p class="profile-bio" id="bio-text">{{ artist.bio }}</p>

        {% if user == artist.user or user.is_staff%}
        <button id="edit-bio-button" data-artist-slug="{{ artist.slug }}">Edit Description</button>
        <button id="save-bio-button" style="display: none;">Save Description</button>
        {% endif %}

        <p> {{ artist.user.username }}'s Genres: </p>
        <div class="genre-tags" id="genre-tags">
            {% for tag in artist.genre_tags.all %}
              <div class="genre">{{ tag.tag }}</div>
            {% empty %}
              <div>No genres available.</div>
            {% endfor %}
        </div>

        {% if user == artist.user or user.is_staff%}
        <div class="add-genre">
            <label for="genre">Add Genre:</label>
            {% include "components/input.html" with id="genre" name="genre" type="select" variant="dark" placeholder="Select Genres.." size="md" options=options %}
            <script>
            document.addEventListener("DOMContentLoaded", function() {
                document.getElementById("genre").setAttribute("data-artist-slug", "{{ artist.slug }}");
            });
            </script>
            {% include "components/button.html" with id="add-genre-button" type="submit" variant="primary" text="Add" size="sm" %}
        </div>
        {% endif %}



    </section>

    {% if user == artist.user or user.is_staff %}
    <div class="add-social-link">
        <label for="social-type">Add Social Link:</label>
        <select id="social-type" name="social-type" data-artist-slug="{{ artist.slug }}">
            <option value="Spotify">Spotify</option>
            <option value="Instagram">Instagram</option>
            <option value="Facebook">Facebook</option>
            <option value="YouTube">YouTube</option>
        </select>
        <label for="social-url"></label>
        <input type="url" id="social-url" name="social-url" placeholder="Enter URL">
        {% include "components/button.html" with id="add-social-link-button" type="submit" variant="primary" text="Add" size="sm" %}
    </div>

    {% endif %}

    <h2> {{ artist.user.username }}'s Socials: </h2>
    <ul id="link-container">
      {% for social_link in artist.social_links.all %}
          <li class="link-item">
          <a href="{{ social_link.url }}">{% include "components/button.html" with id="button9" type="button" variant="rainbow" class="social-buttons" text=social_link.type size="md" %}</a>
          {% if user == artist.user or user.is_staff %}
            <div class="delete-social-link" data-social-link-id="{{ social_link.id }}">
                <img src="{% static 'icons/trash.svg' %}" alt="Delete" class="delete-icon">
            </div>
        {% endif %}
          </li>
      {% empty %}
          <li id="empty-message">No socials available.</li>
      {% endfor %}
    </ul>

    {% if top_track %}
    <section class="profile-top-track">
        <h3>Top Track on Spotify</h3>
        <div class="top-track-container">
            <img src="{{ top_track.album_image }}" alt="Album artwork" class="album-artwork">
            <div class="track-details">
                <h4>{{ top_track.name }}</h4>
                <p>From: {{ top_track.album_name }}</p>
                {% if top_track.preview_url %}
                    <audio controls>
                        <source src="{{ top_track.preview_url }}" type="audio/mpeg">
                        Your browser does not support the audio element.
                    </audio>
                {% endif %}
                <a href="{{ top_track.external_url }}" target="_blank" class="spotify-link">
                    {% include "components/button.html" with type="button" variant="rainbow" text="Listen on Spotify" size="sm" %}
                </a>
            </div>
        </div>
    </section>
    {% endif %}

    <section class="profile-gigs">
        <div class="gigs-section" style="width: 70%; margin-top: 0;">
        <div class="right" style="width: 100%">
            {% for gig in artist.gigs.all %}
              <a class="gig" href="{% url 'gig' gig.artist.slug gig.id %}">
                <div class="date"><div class="num">{{ gig.date|date:"d" }}</div> {{ gig.date|date:"F" }}</div>
                <div class="description"><div class="name">{{ artist.user.username }}</div> with - {{ gig.venue.name }} | {{ gig.date|date:"d/m/Y" }}</div>
                <div class="buy-btn"> Buy Tickets </div>
              </a>
            {% empty %}
              <p> {{ artist.user.username }} currently has no gigs! </p>
            {% endfor %}
            </div>
            </div>
        </section>

        <section class="profile-gig-form">
    
        {% if user.is_staff or user == artist.user  %}
            {% include "components/button.html" with id="add-gig-form-button" type="submit" variant="primary" text="Post a new gig?" size="sm" %}

            <div class="gig-forms-container">
            
              <form method="post" action="{% url 'artist' artist.slug %}" enctype="multipart/form-data">
                {% csrf_token %}

                <input type="hidden" name="artist" value="{{ artist.slug }}">
                <input type="hidden" name="is_approved" value="false">

                <div id="gig-form-gig-section">
                  <h2 class="gig-form-headings">Gig Details</h2>
                  <div class="form-section gig-section">
                    <div class="gig-form-row">
                      <label for="{{ gig_form.supporting_artists.id_for_label }}">Supporting Artists:</label>
                      <div class="inline-field">
                        {% include "components/input.html" with id="gig_form.supporting_artists.auto_id" name="gig_form.supporting_artists.html_name" type="select" variant="light" placeholder="Supporting Artists..." size="lg" options=supporting_artists_options %}
                        {% for error in gig_form.supporting_artists.errors %}
                          <div class="error">{{ error }}</div>
                        {% endfor %}
                      </div>

                      <label for="{{ gig_form.date.id_for_label }}">Date:</label>
                      <div class="inline-field">
                        {% include "components/input.html" with id=gig_form.date.auto_id name=gig_form.date.html_name type="datetime-local" variant="light" placeholder="Enter Gig Date..." size="lg" %}
                        {% for error in gig_form.date.errors %}
                          <div class="error">{{ error }}</div>
                        {% endfor %}
                      </div>
                    </div>
                    <div class="gig-form-row">
                      <label for="{{ gig_form.price.id_for_label }}">Price:</label>
                      <div class="inline-field">
                        {% include "components/input.html" with id=gig_form.price.auto_id name=gig_form.price.html_name type="number" variant="light" placeholder="Enter Gig Price..." size="lg" %}
                        {% for error in gig_form.price.errors %}
                          <div class="error">{{ error }}</div>
                        {% endfor %}
                      </div>
          
                      <label for="{{ gig_form.booking_fee.id_for_label }}">Booking Fee:</label>
                      <div class="inline-field">
                        {% include "components/input.html" with id=gig_form.booking_fee.auto_id name=gig_form.booking_fee.html_name type="number" variant="light" placeholder="Enter Gig Booking Fee..." size="lg" %}
                        {% for error in gig_form.booking_fee.errors %}
                          <div class="error">{{ error }}</div>
                        {% endfor %}
                      </div>
                    </div>
                    <div class="gig-form-row">
                      <label for="{{ gig_form.capacity.id_for_label }}">Capacity:</label>
                      <div class="inline-field">
                        {% include "components/input.html" with id=gig_form.capacity.auto_id name=gig_form.capacity.html_name type="number" variant="light" placeholder="Enter Gig Capacity..." size="lg" %}
                        {% for error in gig_form.capacity.errors %}
                          <div class="error">{{ error }}</div>
                        {% endfor %}
                      </div>
                   
                      <label for="{{ gig_form.gig_photo_url.id_for_label }}">Gig Photo URL:</label>
                      <div class="inline-field">
                        {% include "components/input.html" with id=gig_form.gig_photo_url.auto_id name=gig_form.gig_photo_url.html_name type="text" variant="light" placeholder="Enter Gig Photo URL..." size="lg" %}
                        {% for error in gig_form.gig_photo_url.errors %}
                          <div class="error">{{ error }}</div>
                        {% endfor %}
                      </div>
                    </div>
                    <div class="gig-form-row">
                      <label for="{{ gig_form.description.id_for_label }}">Gig Description:</label>
                      <div class="inline-field">
                        {% include "components/input.html" with id=gig_form.description.auto_id name=gig_form.description.html_name type="textarea" variant="light" placeholder="Enter Gig Description..." size="lg" %}
                        {% for error in gig_form.description.errors %}
                          <div class="error">{{ error }}</div>
                        {% endfor %}
                      </div>
                    </div>
                    
                  </div>
                </div>
                
                <div id="gig-form-address-section">
                <h2 class="gig-form-headings">Venue Address Details</h2>
                <div class="form-section address-section inline">
                  <div class="gig-form-row">
                    <div class="inline-field">
                      <label for="{{ address_form.line_1.id_for_label }}">Line 1:</label>
                      {% include "components/input.html" with id=address_form.line_1.auto_id name=address_form.line_1.html_name type="text" variant="light" placeholder="Enter Address Line 1..." size="lg" %}
                      {% for error in address_form.line_1.errors %}
                        <div class="error">{{ error }}</div>
                      {% endfor %}
                    </div>
                  
                    <div class="inline-field">
                      <label for="{{ address_form.line_2.id_for_label }}">Line 2:</label>
                      {% include "components/input.html" with id=address_form.line_2.auto_id name=address_form.line_2.html_name type="text" variant="light" placeholder="Enter Address Line 2..." size="lg" %}
                      {% for error in address_form.line_2.errors %}
                        <div class="error">{{ error }}</div>
                      {% endfor %}
                    </div>
                 
              
                    <div class="inline-field">
                    <label for="{{ address_form.country.id_for_label }}">Country:</label>
                      {% include "components/input.html" with id=address_form.country.auto_id name=address_form.country.html_name type="text" variant="light" placeholder="Enter Country..." size="lg" %}
                      {% for error in address_form.country.errors %}
                        <div class="error">{{ error }}</div>
                      {% endfor %}
                    </div>
                  </div>
                  <div class="gig-form-row">
                    <div class="inline-field">
                      <label for="{{ address_form.city.id_for_label }}">City:</label>
                      {% include "components/input.html" with id=address_form.city.auto_id name=address_form.city.html_name type="text" variant="light" placeholder="Enter City..." size="lg" %}
                      {% for error in address_form.city.errors %}
                        <div class="error">{{ error }}</div>
                      {% endfor %}
                    
                  </div>
                  
                    <div class="inline-field">
                      <label for="{{ address_form.state_or_province.id_for_label }}">State/Province:</label>
                      {% include "components/input.html" with id=address_form.state_or_province.auto_id name=address_form.state_or_province.html_name type="text" variant="light" placeholder="Enter State/Province..." size="lg" %}
                      {% for error in address_form.state_or_province.errors %}
                        <div class="error">{{ error }}</div>
                      {% endfor %}
                    </div>
                  
        
                    
                    <div class="inline-field">
                      <label for="{{ address_form.post_code.id_for_label }}">Post Code:</label>
                      {% include "components/input.html" with id=address_form.post_code.auto_id name=address_form.post_code.html_name type="text" variant="light" placeholder="Enter Post Code..." size="lg" %}
                      {% for error in address_form.post_code.errors %}
                        <div class="error">{{ error }}</div>
                      {% endfor %}
                    </div>
                  </div>
                </div>
              </div>
                
              <div id="gig-form-venue-section">
                <h2 class="gig-form-headings">Venue Details</h2>
                <div class="form-section venue-section inline">
                  <div class="inline-field">
                    <label for="{{ venue_form.name.id_for_label }}">Venue Name</label>
                    {% include "components/input.html" with id=venue_form.name.auto_id name=venue_form.name.html_name type="text" variant="light" placeholder="Enter Venue Name..." size="lg" %}
                    {% for error in venue_form.name.errors %}
                      <div class="error">{{ error }}</div>
                    {% endfor %}
                  </div>
                  
                  <div class="inline-field">
                    <label for="{{ venue_form.venue_photo_url.id_for_label }}">Venue Photo URL</label>
                    {% include "components/input.html" with id=venue_form.venue_photo_url.auto_id name=venue_form.venue_photo_url.html_name type="text" variant="light" placeholder="Enter Venue Photo URL..." size="lg" %}
                    {% for error in venue_form.venue_photo_url.errors %}
                      <div class="error">{{ error }}</div>
                    {% endfor %}
                  </div>

                  <div class="inline-field">
                    <label for="{{ venue_form.description.id_for_label }}">Venue Description</label>
                    {% include "components/input.html" with id=venue_form.venue_description.auto_id name=venue_form.description.html_name type="textarea" variant="light" placeholder="Enter Venue Description..." size="lg" %}
                    {% for error in venue_form.description.errors %}
                      <div class="error">{{ error }}</div>
                    {% endfor %}
                  </div>
                </div>
              </div>
            
                {% include "components/button.html" with id="gig-form-submit-button" type="submit" variant="primary" text="Submit Form" size="md" %}
              </div>
              </form>
              

              </div>
            {% endif %}
          </section>

    

    </section>
    {% else %}
        <div class="unapproved-message">
        <div class="message">
            <h1> This artist's profile has not yet been approved.</h1>
            <h4> Please check back soon. </h4>
        </div>
        </div>
    {% endif %}

{% endblock %}
