{% extends "Off_Axis/base.html" %}
{% load static %}
{% block title_block %}
    Off Axis Gigs - {{ gig.artist.user.username|upper }} {{ gig.venue.address.city|upper }}
{% endblock title_block %}
{% block import_block %}
    <link rel="stylesheet" href="{% static "styles/gig.css" %}">
{% endblock import_block %}
{% block body_block %}

    {% if user == gig.artist.user or user.is_staff %}
    <section id="approval-section">
        <h2>Approval Status</h2>
        <p>{{ gig.artist.user.username }}'s Gig Approval Status: {{ gig.is_approved }}</p>
        {% if user.is_staff %}
            <form method="post" action="{% url 'approve_gig' gig.id %}">
                {% csrf_token %}
                <label for="approve">Approve Gig:</label>
                <input type="checkbox" id="approve" name="approve" {% if gig.is_approved %}checked{% endif %}>
                {% include "components/button.html" with id="button3" type="submit" variant="secondary" text="Save" size="sm" %}
            </form>
        {% endif %}
    </section>
    {% endif %}


    <section class="gig-page">
        <img src="{{ gig.gig_photo_url }}"
             width="500"
             height="500"
             alt="{{ gig.artist.user.username }}'s gig"
             class="gig-page__image">
        <div class="gig-page__details">
            <h1 class="gig-page__title">{{ gig.artist.user.username }}</h1>
            <div class="gig-page__info">
                <p>{{ gig.date|date:"d/m/Y" }}</p>
                <p>Start time - {{ gig.date|date:"H:i" }}</p>
                <p>{{ gig.venue.name }}, {{ gig.venue.address.city }}</p>
            </div>
            <div class="gig-page__price">
                <h2>
                    Ticket Price <span>£{{ gig.price }}</span>
                </h2>
            </div>
            <p class="gig-page__tickets-status">
                {% if tickets_sold >= capacity %}
                    Sold Out!
                {% elif tickets_sold >= capacity_last_few %}
                    Last Few Tickets!
                {% else %}
                    Tickets Available!
                {% endif %}
            </p>
            <table class="gig-page__price-table">
                <tr>
                    <td>Booking Fee Per Ticket</td>
                    <td>£{{ gig.booking_fee }}</td>
                </tr>
                <tr>
                    <td>Total Payable Amount</td>
                    <td>£{{ gig.full_price }}</td>
                </tr>
            </table>
            <form class="gig-page__form" action="/cart/" method="post">
                <div class="gig-page__form__quantity">
                    {% include "components/label.html" with variant="dark" required="true" for="quantity" size="lg" text="Quantity" %}
                    {% include "components/input.html" with id="quantityInput" name="quantity" type="number" variant="light" placeholder="1" size="lg" full="true" value="1" %}
                </div>
                {% include "components/button.html" with id="submitButton" type="submit" variant="rainbow" text="Add to cart" size="lg" %}
                <input type="hidden" name="gig_id" value="{{ gig.id }}">
                <input type="hidden" name="action" value="add">
                {% csrf_token %}
            </form>
            <p class="gig-page__description">{{ gig.description }}</p>
        </div>
    </section>
{% endblock body_block %}
